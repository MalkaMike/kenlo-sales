# Project TODO

## Completed Features
- [x] Portal structure with all main pages
- [x] Kenlo design system applied (Manrope font, colors #F82E52 pink, #4ABD8D green)
- [x] Calculator copied from kenloai project
- [x] Header and navigation implemented
- [x] Fixed nested anchor tag errors
- [x] Reorganized Kenlo Imob and Kenlo Locação into sub-boxes
- [x] Implemented Serviços Premium section with correct pricing logic
- [x] Fixed ortografia "Incluído" com acento

## New Features - PDF Export with Database
- [x] Criar schema do banco de dados para propostas (salvar vendedor, cliente, configurações, preços, data)
- [x] Implementar modal/formulário para capturar nome do vendedor e nome do cliente
- [x] Implementar geração de PDF com todos os detalhes da proposta
- [x] Implementar API tRPC para salvar propostas no banco de dados
- [x] Testar fluxo completo: preencher dados → gerar PDF → salvar no banco

## Mobile Optimization

- [x] Ajustar header e navegação para mobile
- [x] Otimizar seções de seleção de produtos para telas pequenas
- [x] Ajustar cards de add-ons para layout responsivo
- [x] Otimizar inputs e formulários para touch
- [x] Ajustar tabela de preços para mobile (scroll horizontal)
- [x] Otimizar seção "The Kenlo Effect" para mobile
- [x] Ajustar botões de ação para tamanho adequado em touch
- [x] Testar em viewport mobile (375px, 390px, 428px)

## UI Improvements

- [x] Mover barra de resumo de produtos (sticky bar) do topo para o rodapé da calculadora
- [x] Transformar barra em sticky bottom (fixed na parte inferior da tela)

## Sticky Bar Improvements

- [x] Reduzir tamanho da fonte da barra sticky bottom
- [x] Adicionar add-ons selecionados na barra
- [x] Adicionar frequência de pagamento escolhida na barra
- [x] Garantir que todas as escolhas do usuário estejam visíveis

## Kombo Naming System

- [x] Criar lógica de detecção automática de Kombos baseada em produtos/add-ons selecionados
- [x] Implementar descontos específicos por Kombo (10%, 15%, 20%)
- [x] Mostrar nome do Kombo na barra sticky bottom
- [x] Atualizar tabela de preços para indicar qual Kombo está ativo
- [x] Incluir nome do Kombo no PDF gerado
- [x] Salvar nome do Kombo no banco de dados junto com a proposta
- [x] Testar todos os 5 Kombos (Imob Start, Imob Pro, Locação Pro, Core Gestão, Elite)

## Kombo Core Gestão Fix

- [x] Corrigir lógica do Kombo Core Gestão: desconto APENAS na implantação (50% OFF = R$ 1.497 ao invés de R$ 2.994)
- [x] Mensalidades do Kombo Core Gestão devem usar preço normal da tabela (SEM desconto)
- [x] Atualizar descrição do Kombo Core Gestão na barra sticky e documentação

## Payment Frequency Buttons

- [x] Adicionar botão "Mensal (0% - Referência)" aos botões de frequência
- [x] Ajustar layout para 4 botões: Mensal, Semestral, Anual, Bienal
- [x] Atualizar tipo PaymentFrequency para incluir "monthly"
- [x] Testar seleção de frequência mensal

## Price Review and Corrections

- [x] Corrigir preço do K2: R$ 997 → R$ 1.197 (IMOB e LOC)
- [x] Revisar regras de frequência de pagamento (Mensal, Semestral, Anual, Bienal)
- [x] Verificar regra de arredondamento (sempre terminar em 7)
- [x] Revisar preços de add-ons (Inteligência, Leads, Assinatura)
- [x] Revisar custos pós-pago (usuários, contratos, WhatsApp, boletos, split)
- [x] Revisar descontos dos Kombos (10%, 15%, 20%)
- [x] Revisar implantação dos Kombos (R$ 1.497 fixo)
- [x] Testar todos os cálculos com K2 atualizado

## Vendor Dropdown with Autocomplete

- [x] Criar lista de 10 vendedores no código
- [x] Substituir Input de "Nome do Vendedor" por Combobox com autocomplete
- [x] Implementar busca fuzzy para encontrar nomes com erros de digitação
- [x] Testar seleção de vendedor e autocomplete

## Table Layout Fix

- [x] Corrigir layout da box "Sem Kombo" do lado direito para ocupar apenas as últimas 2 colunas
- [x] Garantir que a mensagem "Adicione mais add-ons" fique centralizada nas 2 colunas
- [x] REAL FIX: Mover box "Adicione mais add-ons" para cobrir colunas Mensal+Semestral da seção "Kombo Ativado" (lado direito) em vez de "Sem Kombo" (lado esquerdo)
- [x] REAL REAL FIX: Manter 5 colunas sempre, mas quando não há Kombo, as últimas 2 colunas mostram os mesmos preços "Sem Kombo" (visíveis) e a box overlay cobre essas 2 últimas colunas com a mensagem
- [x] FINAL FIX: Box overlay deve cobrir TODA a área das últimas 2 colunas desde o topo (top-0) incluindo headers "Sem Kombo", "Mensal" e "Anual" até a última linha
- [x] REAL FINAL FIX: Ajustar condição da box overlay de `activeKombo === 'none'` para `Object.values(addons).every(enabled => !enabled)` porque Core Gestão (IMOB+LOC sem add-ons) é um Kombo válido
- [x] CRITICAL FIX: Box overlay está cobrindo a 2ª coluna "Sem Kombo" (frequência escolhida). Deve cobrir APENAS as últimas 2 colunas (Kombo Ativado), deixando AMBAS colunas Sem Kombo visíveis (Mensal + Frequência) - Ajustado de w-[40%] para w-[35%]

## Text Corrections

- [x] Remover "- Cobrança" do título "Kenlo Pay - Cobrança", deixando apenas "Kenlo Pay"

## Dynamic Savings Badge

- [x] Adicionar badge dinâmico de economia no header "Kombo Ativado" mostrando porcentagem de desconto quando há Kombo ativo

## Navigation Menu Updates

- [x] Remover texto "SALES" do menu de navegação
- [x] Alinhar "Kombos" com os outros itens do menu (remover margem extra)
- [x] Remover bandeira "BR" (seletor de idioma)
- [x] Remover botão "Simular Proposta"
- [x] Substituir "Calculadora" por "Monte seu plano"

## Kombos Alignment Fix

- [x] Corrigir alinhamento vertical do item "Kombos" no menu - removido badge "NOVO" que causava desalinhamento

## Premium Services Bug Fix

- [x] BUG: Quando Suporte Premium e CS Dedicado são desativados nos "Planos Recomendados", o Suporte Premium ainda mostra "R$ 99" em vez de "Não Incluído" - corrigido adicionando verificação de isSelected (metrics.imobVipSupport e metrics.locVipSupport)

## Complete Rules Verification and Fixes

### Payment Frequency Rules (Lines 2-10)
- [ ] Mensal → Preço Anual ÷ (1 – 20%) = Preço Anual × 1.25
- [ ] Semestral → Preço Anual ÷ (1 – 10%) = Preço Anual × 1.111...
- [ ] Anual → Preço Anual (reference/default)
- [ ] Bienal → Preço Anual × (1 – 10%) = Preço Anual × 0.9

### Rounding Rule (Lines 18-19)
- [ ] All prices must round UP to next integer ending in 7 (applies to all products/add-ons, all frequencies, NOT for post-paid)

### Add-on Availability (Lines 11-17)
- [ ] Inteligência → available for IMOB and/or LOC
- [ ] Leads → available for IMOB ONLY
- [ ] Assinaturas → available for IMOB and/or LOC
- [ ] Pay → available for LOC ONLY
- [ ] Seguros → available for LOC ONLY
- [ ] Cash → available for LOC ONLY

### Kombo Discounts and Implementation (Lines 374-423)
- [ ] Kombo Imob Start (IMOB + Leads + Assinaturas) → 10% OFF all products/add-ons, R$ 1.497 implementation (Leads impl. free)
- [ ] Kombo Imob Pro (IMOB + Leads + Inteligência + Assinatura) → 15% OFF all, R$ 1.497 impl. (Leads + Inteligência impl. free)
- [ ] Kombo Locação Pro (LOC + Inteligência + Assinatura) → 10% OFF all, R$ 1.497 impl. (Inteligência impl. free)
- [ ] Kombo Core Gestão (IMOB + LOC without add-ons) → "Conforme tabela" discount, R$ 1.497 impl. (IMOB impl. free)
- [ ] Kombo Elite (IMOB + LOC + ALL add-ons) → 20% OFF all, R$ 1.497 impl. (IMOB + Leads + Inteligência impl. free)

### Current Implementation Issues to Fix
- [x] Verify current frequency multipliers match document (Mensal 1.25, Semestral 1.111, Anual 1.0, Bienal 0.9) - VERIFIED CORRECT
- [x] Verify rounding function rounds UP to next number ending in 7 - FIXED (was rounding to nearest, now always UP)
- [x] Verify add-on availability restrictions (Leads IMOB-only, Pay/Seguros/Cash LOC-only) - VERIFIED CORRECT
- [x] Verify Kombo discount percentages (Start 10%, Pro 15%, Locação Pro 10%, Elite 20%) - VERIFIED CORRECT
- [x] Verify "Core Gestão" discount logic ("conforme tabela" - needs clarification) - FIXED (0% discount on monthly, R$ 1.497 fixed impl.)
- [x] Verify implementation costs for all Kombos are R$ 1.497 - VERIFIED CORRECT

## Kombos Page

- [x] Criar página /kombos com galeria visual comparativa dos 5 Kombos
- [x] Implementar cards para cada Kombo mostrando: composição (produtos + add-ons), desconto percentual, implantação, casos de uso ideais
- [x] Adicionar seção hero explicando o conceito de Kombos e benefícios
- [x] Incluir CTA para "Monte seu plano" redirecionando para calculadora
- [x] Rota /kombos já existe no App.tsx

## Core Gestão Premium Services Rule

- [x] Implementar nova regra: Kombo Core Gestão (IMOB + LOC, qualquer plano) inclui automaticamente Serviços Premium (Suporte VIP + CS Dedicado) sem custo adicional
- [x] Atualizar lógica da calculadora para marcar Serviços Premium como "Incluído" quando Core Gestão está ativo
- [x] Atualizar descrição do Kombo Core Gestão na página /kombos para mencionar Serviços Premium incluídos
- [x] Testar cenários: Prime+Prime, K+K, K2+K2, Prime+K, etc. todos devem ter Serviços Premium incluídos - 12 testes passaram

## Correções de Valores dos Serviços Premium e Implantações dos Kombos

- [x] Corrigir valor do Suporte VIP de R$ 99 para R$ 97/mês
- [x] Corrigir valor do CS Dedicado de R$ 99 para R$ 197/mês
- [x] Atualizar descrição dos Kombos com informações corretas de implantação:
  - [x] Kombo Imob Start: Implantação de Leads ofertada (economia de R$ 497)
  - [x] Kombo Imob Pro: Implantação de Leads e Inteligência ofertadas (economia de R$ 994)
  - [x] Kombo Locação Pro: Implantação de Inteligência ofertada (economia de R$ 497)
  - [x] Kombo Core Gestão: Implantação de IMOB ofertada (economia de R$ 1.497)
  - [x] Kombo Elite: Implantação de Imob, Leads e Inteligência ofertadas (economia de R$ 2.491)
- [x] Validar todos os valores com testes automatizados - 28 testes passaram + validação visual completa

## Reorganização da Seção "Informações do Negócio" e Simplificação de Serviços Premium

### Kenlo IMOB - Criar boxes agrupadas:
- [x] Box "Leads" contendo:
  - [x] Leads recebidos por mês
  - [x] IA SDR Externa (Ex: Lais)
  - [x] WhatsApp Integrado
- [x] Box "Serviços Premium" contendo:
  - [x] Suporte VIP
  - [x] CS Dedicado

### Kenlo Locação - Criar boxes agrupadas:
- [x] Box "Kenlo Pay" (já existente, manter como está)
- [x] Box "Serviços Premium" contendo:
  - [x] Suporte VIP
  - [x] CS Dedicado

### Tabela "4. Planos Recomendados":
- [x] Simplificar seção "Serviços Premium" para ter apenas 2 linhas:
  - [x] Suporte VIP (sem -IMOB/-LOC)
  - [x] CS Dedicado (sem -IMOB/-LOC)
- [x] Atualizar lógica de exibição:
  - [x] Se cliente tem 1 produto: mostrar preço (R$ 97 ou R$ 197) ou "Incluído" conforme plano
  - [x] Se cliente tem 2 produtos (IMOB + LOC): mostrar "Incluído" (Kombo Core Gestão)

## Kombo Elite - Serviços Premium Incluídos

- [x] Implementar regra: Kombo Elite (IMOB + LOC + todos add-ons) inclui automaticamente Serviços Premium (Suporte VIP + CS Dedicado) sem custo adicional
- [x] Atualizar lógica da calculadora para marcar Serviços Premium como "Incluído" quando Kombo Elite está ativo
- [x] Atualizar descrição do Kombo Elite na página /kombos para mencionar Serviços Premium incluídos
- [x] Criar testes automatizados para validar Kombo Elite com Serviços Premium incluídos
- [x] Validar com testes e verificação visual - 42 testes passaram + validação visual completa

## Seção "4 bis. Preço Sem Kombo vs Kombo" - Tabela Comparativa

- [x] Projetar estrutura da tabela comparativa:
  - [x] Colunas: Sem Kombo, Imob Start, Imob Pro, Locação Pro, Core Gestão, Elite
  - [x] Linhas: Produtos (IMOB, LOC), Add-ons (Leads, Inteligência, Assinatura, Pay, Seguros, Cash), Serviços Premium (Suporte VIP, CS Dedicado), Total Mensal, Implantação, Anual Equivalente
  - [x] Toggle Mensal/Anual para alternar visualização
- [x] Implementar cálculo de preços para todos os Kombos baseado nas escolhas do usuário
- [x] Implementar lógica de highlight automático do Kombo recomendado
- [x] Implementar UI da tabela comparativa com design responsivo
- [x] Validar com testes e verificação visual - 67 testes passaram
- [ ] Apresentar ao usuário para aprovação (se aprovado, substituir seção 4 atual)

## Mostrar valores para todos os Kombos (mesmo não aplicáveis)
- [x] Remover lógica que esconde valores de Kombos não aplicáveis
- [x] Mostrar preços de todos os Kombos sempre, permitindo comparação hipotética
- [x] Manter highlight apenas no Kombo recomendado (Elite com badge "Recomendado" e 20% OFF)

## Atualizar seletor de frequência na seção 4 bis
- [x] Substituir toggle Mensal/Anual por 4 cards: Mensal (0% - Referência), Semestral (-15%), Anual (-20%), Bienal (-25%)
- [x] Centralizar cards acima da tabela
- [x] Usar visual de cards com borda arredondada, card selecionado com fundo rosa claro e borda rosa
- [x] Espalhar cards uniformemente na largura da tabela

## Mudança de conceito de frequência
- [x] Mudar Anual para ser a referência (0%), Mensal (+25%), Semestral (+10%), Bienal (-10%)

## Correção de Recomendação de Kombos
- [x] Corrigir lógica: IMOB + Leads + Assinatura deve recomendar "Imob Start" (não "Sem Kombo")
- [x] Verificar todas as combinações de Kombos estão sendo detectadas corretamente

## Seleção Automática do Melhor Plano
- [x] Implementar lógica para recomendar Prime/K/K2 baseado no número de usuários (IMOB)
- [x] Implementar lógica para recomendar Prime/K/K2 baseado no número de contratos (LOC)
- [x] Considerar custo total: mensalidade + usuários/contratos adicionais
- [x] Mostrar plano recomendado em vermelho/rosa (ex: "Imob - K")

## Atualização de Preços IMOB (Fev 2026)
- [x] Atualizar preços base: Prime R$247, K R$497, K2 R$1.197
- [x] Atualizar usuários inclusos: Prime 2, K 7, K2 15
- [x] Implementar cálculo de usuários adicionais por faixas:
  - Prime: R$57 fixo por usuário
  - K: 1-10 = R$47, 11+ = R$37
  - K2: 1-10 = R$47, 11-50 = R$37, 51+ = R$27
- [x] Atualizar lógica de seleção automática do melhor plano com novos preços

## Correção Regras dos Kombos (Fev 2026)
- [x] Imob Start: NÃO inclui VIP/CS Dedicado (cliente paga à parte)
- [x] Imob Pro: INCLUI VIP + CS Dedicado
- [x] Locação Pro: INCLUI VIP + CS Dedicado
- [x] Core Gestão: INCLUI VIP + CS Dedicado
- [x] Elite: INCLUI VIP + CS Dedicado
- [x] Triple check: revisar todos os cálculos e regras
